# Sparkker: A Spark Analysis module for [Stokker](https://github.com/victor-ferrer/stokker)

[![Travis CI Status](https://travis-ci.org/victor-ferrer/sparkker.svg?branch=master)](https://travis-ci.org/victor-ferrer/sparkker)

## Summary

This a personal learning project whose functionality, for the moment, is to:
- Using Spring Cloud Netflix orchestrate itself with the [Stokker](https://github.com/victor-ferrer/stokker) and [Portfolio-Manager](https://github.com/victor-ferrer/stokker-portfolio-manager) modules.
- Retrieve Stock quotations via Rest
- Perform analysis in a Spark Module (calculate deviations, moving averages, etc.)
- Execute a set of Drools Rules to make BUY/SELL recommendations.
- Send them back to Stokker to be stored

This is a snapshot of the current user interface showing a Stock being plotted along with some Indicators (Simple Moving Average (SMA), Max/Min value in a sliding period of time, etc.)

![UI Screenshot](https://raw.githubusercontent.com/victor-ferrer/sparkker/master/ui_screenshot.PNG)

## How to launch it
There are several ways to run the program:
* *Data acquisition*: You can either get the data from Stokker or from a set of sample files within Sparkker.
If you want to use [Stokker](https://github.com/victor-ferrer/stokker) as data source you need to run it along with the [Portfolio Manager](https://github.com/victor-ferrer/stokker-portfolio-manager) (which act as discovery server).

If this is too much a fuzz for you, use this parameter to run offline (using the sample files):
```
--data.feed.online=false
```

The files are located here: 
```
/src/main/resources/data
```

- *Drools rules file*: Also, you will need to specify the path to the Drools Rules file (which you can edit with a text editor and check the results without recompiling)
```
--rules.file.path=../rules.dlr 
```
They are located here: 
```
/src/main/resources/org/vferrer/sparkker/service/rules.dlr
```

So, a line command execution will look like this:

```java
java -jar sparkker-0.0.1-SNAPSHOT.jar --rules.file.path=../rules.dlr --data.feed.online=false
```


## Technology stack
- Spring Boot 1.3.3 in the Server Side.
- Apache Spark 
- AngularJS in the front-end.
- Angular Chart to show stock charts.
- Drools 6.3 as rule engine

## Status
This is work in progress:
- Stocks might be retrieved from Stokker or from a set of sample files
- SMA, MAX, MIN indicators are calculated and represented in a graph.
- A secondary SCORE indicator is calculated based on the other indicators and a BUY/SELL recomendation is given.
- That recomendation is generated by a set of Drools Rules.
- The result is just printed in the stdout and resulting web page. It should be sent to Stokker to be indexed in Elastic Search.
